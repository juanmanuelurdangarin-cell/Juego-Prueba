<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Arcade: Levels & Tiers</title>
    <style>
        body { margin: 0; background: #050510; color: #00d4ff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; }
        canvas { background: #000; border: 2px solid #00d4ff; max-width: 100%; max-height: 70vh; touch-action: none; }
        .menu { position: absolute; width: 90%; max-width: 400px; background: rgba(10, 10, 30, 0.95); border: 2px solid #00d4ff; padding: 20px; box-sizing: border-box; border-radius: 15px; text-align: center; z-index: 10; }
        .hidden { display: none !important; }
        .gold-counter { font-size: 1.5em; color: #ffd700; margin-bottom: 10px; font-weight: bold; }
        button { background: #002233; color: #00d4ff; border: 1px solid #00d4ff; padding: 10px; margin: 4px 0; cursor: pointer; width: 100%; font-weight: bold; }
        .upgrade-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.8em; padding: 4px 0; border-bottom: 1px solid #003344; }
    </style>
</head>
<body>

    <div id="hangar" class="menu">
        <h2>HANGAR - NIVEL <span id="current-max-level">1</span></h2>
        <div id="gold-menu" class="gold-counter">游눯 0</div>
        
        <div class="upgrade-row"><span>Ca침ones (Multi):</span> <button onclick="buyUpgrade('cannons')" style="width:100px">Mejorar (<span id="cost-cannons">150</span>)</button></div>
        <div class="upgrade-row"><span>Cadencia:</span> <button onclick="buyUpgrade('fireRate')" style="width:100px">Mejorar (<span id="cost-fireRate">80</span>)</button></div>
        <div class="upgrade-row"><span>Escudos:</span> <button onclick="buyUpgrade('hp')" style="width:100px">Mejorar (<span id="cost-hp">100</span>)</button></div>
        
        <button style="margin-top:20px; background:#006622; color:white;" onclick="startMission()">INICIAR MISI칍N</button>
    </div>

    <canvas id="gameCanvas" class="hidden"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 400;
    canvas.height = 600;

    // --- CONFIGURACI칍N DE ENEMIGOS POR NIVEL ---
    const enemyTiers = [
        { name: "Scout", hp: 1, color: "#ff4444" },
        { name: "Raider", hp: 2, color: "#ff8800" },
        { name: "Vanguard", hp: 3, color: "#ffff00" },
        { name: "Interceptor", hp: 4, color: "#00ff00" },
        { name: "Guardian", hp: 6, color: "#0088ff" },
        { name: "Enforcer", hp: 8, color: "#8800ff" },
        { name: "Destroyer", hp: 11, color: "#ff00ff" },
        { name: "Dreadnought", hp: 15, color: "#ffffff" },
        { name: "Titan", hp: 20, color: "#555555" },
        { name: "Void Ship", hp: 28, color: "#330000" }
    ];

    let stats = {
        gold: 0,
        level: 1,
        upgrades: {
            cannons: { lvl: 1, cost: 150, max: 5 },
            fireRate: { lvl: 1, cost: 80, val: 500 },
            hp: { lvl: 1, cost: 100, val: 1 }
        }
    };

    let gameActive = false, missionScore = 0, lastFire = 0;
    let player = { x: 185, y: 500, w: 30, h: 30 };
    let bullets = [], enemies = [];

    // Controles Touch/Mouse
    function handleMove(e) {
        if (!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        player.x = (clientX - rect.left) * (canvas.width / rect.width) - player.w/2;
    }
    canvas.addEventListener('mousemove', handleMove);
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e); }, {passive: false});

    function updateUI() {
        document.getElementById("gold-menu").innerText = `游눯 ${stats.gold}`;
        document.getElementById("current-max-level").innerText = stats.level;
        for (let key in stats.upgrades) {
            document.getElementById(`cost-${key}`).innerText = stats.upgrades[key].cost;
        }
    }

    function buyUpgrade(type) {
        let u = stats.upgrades[type];
        if (stats.gold >= u.cost) {
            stats.gold -= u.cost;
            u.lvl++;
            u.cost = Math.floor(u.cost * 1.8);
            if (type === 'fireRate') u.val = Math.max(100, u.val - 50);
            if (type === 'hp') u.val += 1;
            updateUI();
        }
    }

    function startMission() {
        document.getElementById("hangar").classList.add("hidden");
        canvas.classList.remove("hidden");
        gameActive = true;
        missionScore = 0;
        player.hp = stats.upgrades.hp.val;
        bullets = []; enemies = [];
        requestAnimationFrame(gameLoop);
    }

    function gameLoop(time) {
        if (!gameActive) return;

        // Disparo Autom치tico
        if (time - lastFire > stats.upgrades.fireRate.val) {
            let n = stats.upgrades.cannons.lvl;
            for(let i=0; i<n; i++) {
                bullets.push({ x: player.x + 13 + (i-(n-1)/2)*15, y: player.y, s: 8 });
            }
            lastFire = time;
        }

        // Progresi칩n de nivel basada en puntos
        if (missionScore > stats.level * 2000 && stats.level < 10) {
            stats.level++;
        }

        // Spawn de enemigos seg칰n nivel actual
        if (Math.random() < 0.04) {
            // Elige un tipo de enemigo aleatorio entre 0 y el nivel actual
            let maxTier = Math.min(stats.level - 1, 9);
            let tierIndex = Math.floor(Math.random() * (maxTier + 1));
            let type = enemyTiers[tierIndex];
            
            enemies.push({ 
                x: Math.random()*370, y: -30, s: 2 + Math.random(), 
                hp: type.hp, maxHp: type.hp, color: type.color 
            });
        }

        // L칩gica de colisiones
        bullets.forEach((b, bi) => {
            b.y -= b.s;
            enemies.forEach((en, ei) => {
                if (b.x < en.x+30 && b.x+4 > en.x && b.y < en.y+30 && b.y+10 > en.y) {
                    en.hp--;
                    bullets.splice(bi, 1);
                    if (en.hp <= 0) {
                        enemies.splice(ei, 1);
                        missionScore += 100 * (tierIndex + 1); // M치s puntos por enemigos fuertes
                    }
                }
            });
        });

        enemies.forEach((en, i) => {
            en.y += en.s;
            if (en.y > canvas.height) enemies.splice(i, 1);
            if (player.x < en.x+30 && player.x+30 > en.x && player.y < en.y+30 && player.y+30 > en.y) {
                player.hp--;
                enemies.splice(i, 1);
                if (player.hp <= 0) endGame();
            }
        });

        draw();
        requestAnimationFrame(gameLoop);
    }

    function endGame() {
        gameActive = false;
        stats.gold += Math.floor(missionScore / 10);
        canvas.classList.add("hidden");
        document.getElementById("hangar").classList.remove("hidden");
        updateUI();
    }

    function draw() {
        ctx.fillStyle = "#050510";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Jugador
        ctx.fillStyle = "#00d4ff";
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // Balas
        ctx.fillStyle = "#ffff00";
        bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));

        // Enemigos con barra de vida peque침a
        enemies.forEach(en => {
            ctx.fillStyle = en.color;
            ctx.fillRect(en.x, en.y, 30, 30);
            // Barra de vida
            ctx.fillStyle = "red";
            ctx.fillRect(en.x, en.y - 5, 30, 3);
            ctx.fillStyle = "lime";
            ctx.fillRect(en.x, en.y - 5, (en.hp/en.maxHp)*30, 3);
        });

        // HUD
        ctx.fillStyle = "white";
        ctx.fillText(`NIVEL: ${stats.level} | PUNTOS: ${missionScore} | HP: ${player.hp}`, 10, 20);
    }

    updateUI();
</script>
</body>
</html>
