<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Arcade: Auto-Fire</title>
    <style>
        body { margin: 0; background: #050510; color: #00d4ff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; }
        canvas { background: #000; border: 2px solid #00d4ff; max-width: 100%; max-height: 70vh; touch-action: none; }
        .menu { position: absolute; width: 90%; max-width: 400px; background: rgba(10, 10, 30, 0.95); border: 2px solid #00d4ff; padding: 20px; box-sizing: border-box; border-radius: 15px; text-align: center; z-index: 10; }
        .hidden { display: none !important; }
        .gold-counter { font-size: 1.5em; color: #ffd700; margin-bottom: 15px; font-weight: bold; }
        button { background: #002233; color: #00d4ff; border: 1px solid #00d4ff; padding: 10px; margin: 4px 0; cursor: pointer; width: 100%; font-weight: bold; font-family: inherit; }
        .upgrade-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; padding: 5px 0; border-bottom: 1px solid #003344; }
        .btn-up { width: 100px; font-size: 0.8em; }
        #instructions { font-size: 0.8em; color: #aaa; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="hangar" class="menu">
        <h2>HANGAR</h2>
        <div id="gold-menu" class="gold-counter">ðŸ’° 0</div>
        
        <div class="upgrade-row">
            <span>CaÃ±ones: <span id="lvl-cannons">1</span></span>
            <button class="btn-up" onclick="buyUpgrade('cannons')">Mejorar (<span id="cost-cannons">150</span>)</button>
        </div>
        <div class="upgrade-row">
            <span>Cadencia</span>
            <button class="btn-up" onclick="buyUpgrade('fireRate')">Mejorar (<span id="cost-fireRate">80</span>)</button>
        </div>
        <div class="upgrade-row">
            <span>Escudos</span>
            <button class="btn-up" onclick="buyUpgrade('hp')">Mejorar (<span id="cost-hp">100</span>)</button>
        </div>
        <div class="upgrade-row">
            <span>Velocidad</span>
            <button class="btn-up" onclick="buyUpgrade('speed')">Mejorar (<span id="cost-speed">50</span>)</button>
        </div>

        <button style="margin-top:20px; background:#006622; color:white;" onclick="startMission()">INICIAR MISIÃ“N</button>
        <div id="instructions">Arrastra la nave para moverte.<br>Â¡El disparo es automÃ¡tico!</div>
    </div>

    <canvas id="gameCanvas" class="hidden"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 400;
    canvas.height = 600;

    let stats = {
        gold: 0,
        upgrades: {
            cannons: { lvl: 1, cost: 150, max: 5 },
            fireRate: { lvl: 1, cost: 80, val: 500 },
            hp: { lvl: 1, cost: 100, val: 1 },
            speed: { lvl: 1, cost: 50, val: 5 }
        }
    };

    let gameActive = false, missionScore = 0, lastFire = 0;
    let player = { x: 185, y: 500, w: 30, h: 30 };
    let bullets = [], enemies = [];

    // --- CONTROLES (PC y MÃ“VIL) ---
    function handleMove(e) {
        if (!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        // Centrar nave en el toque/mouse
        player.x = (clientX - rect.left) * (canvas.width / rect.width) - player.w/2;
    }

    canvas.addEventListener('mousemove', handleMove);
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e); }, {passive: false});

    function updateUI() {
        document.getElementById("gold-menu").innerText = `ðŸ’° ${stats.gold}`;
        for (let key in stats.upgrades) {
            let u = stats.upgrades[key];
            document.getElementById(`lvl-${key}`).innerText = u.lvl;
            document.getElementById(`cost-${key}`).innerText = u.lvl >= (u.max || 99) ? "MAX" : u.cost;
        }
    }

    function buyUpgrade(type) {
        let u = stats.upgrades[type];
        if (u.max && u.lvl >= u.max) return;
        if (stats.gold >= u.cost) {
            stats.gold -= u.cost;
            u.lvl++;
            u.cost = Math.floor(u.cost * 1.7);
            if (type === 'fireRate') u.val = Math.max(120, u.val - 60);
            if (type === 'hp') u.val += 1;
            updateUI();
        }
    }

    function startMission() {
        document.getElementById("hangar").classList.add("hidden");
        canvas.classList.remove("hidden");
        gameActive = true;
        missionScore = 0;
        player.hp = stats.upgrades.hp.val;
        bullets = []; enemies = [];
        requestAnimationFrame(gameLoop);
    }

    function endGame() {
        gameActive = false;
        stats.gold += Math.floor(missionScore / 10);
        alert(`MisiÃ³n terminada. Monedas: ${Math.floor(missionScore / 10)}`);
        canvas.classList.add("hidden");
        document.getElementById("hangar").classList.remove("hidden");
        updateUI();
    }

    function gameLoop(time) {
        if (!gameActive) return;

        // --- DISPARO AUTOMÃTICO ---
        if (time - lastFire > stats.upgrades.fireRate.val) {
            let num = stats.upgrades.cannons.lvl;
            for(let i=0; i<num; i++) {
                let off = (i - (num-1)/2) * 15;
                bullets.push({ x: player.x + 13 + off, y: player.y, s: 8 });
            }
            lastFire = time;
        }

        bullets.forEach((b, i) => { 
            b.y -= b.s; 
            if(b.y < 0) bullets.splice(i, 1); 
        });

        if (Math.random() < 0.05) enemies.push({ x: Math.random()*370, y: -30, s: 3 });

        enemies.forEach((en, ei) => {
            en.y += en.s;
            bullets.forEach((b, bi) => {
                if (b.x < en.x+30 && b.x+4 > en.x && b.y < en.y+30 && b.y+10 > en.y) {
                    enemies.splice(ei, 1);
                    bullets.splice(bi, 1);
                    missionScore += 100;
                }
            });
            if (player.x < en.x+30 && player.x+player.w > en.x && player.y < en.y+30 && player.y+player.h > en.y) {
                player.hp--;
                enemies.splice(ei, 1);
                if (player.hp <= 0) endGame();
            }
            if (en.y > canvas.height) enemies.splice(ei, 1);
        });

        draw();
        requestAnimationFrame(gameLoop);
    }

    function draw() {
        ctx.fillStyle = "#050510";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Jugador
        ctx.fillStyle = "#00d4ff";
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // Balas
        ctx.fillStyle = "#ffff00";
        bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 12));

        // Enemigos
        ctx.fillStyle = "#ff2255";
        enemies.forEach(en => ctx.fillRect(en.x, en.y, 30, 30));

        // HUD
        ctx.fillStyle = "white";
        ctx.font = "14px Arial";
        ctx.fillText(`Puntos: ${missionScore}`, 10, 20);
        ctx.fillText(`Vidas: ${player.hp}`, 10, 40);
    }

    updateUI();
</script>
</body>
</html>
