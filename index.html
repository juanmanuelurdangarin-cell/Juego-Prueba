<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Arcade: ProgresiÃ³n Total</title>
    <style>
        body { margin: 0; background: #050510; color: #00d4ff; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; }
        canvas { background: #000; border: 2px solid #00d4ff; max-width: 100%; max-height: 75vh; touch-action: none; cursor: crosshair; }
        .menu { position: absolute; width: 90%; max-width: 400px; background: rgba(10, 10, 30, 0.95); border: 2px solid #00d4ff; padding: 20px; box-sizing: border-box; border-radius: 15px; text-align: center; z-index: 10; box-shadow: 0 0 20px #00d4ff; }
        .hidden { display: none !important; }
        .gold-counter { font-size: 1.5em; color: #ffd700; margin-bottom: 10px; font-weight: bold; }
        button { background: #002233; color: #00d4ff; border: 1px solid #00d4ff; padding: 12px; margin: 4px 0; cursor: pointer; width: 100%; font-weight: bold; border-radius: 5px; }
        button:active { background: #00d4ff; color: #000; }
        .upgrade-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; padding: 6px 0; border-bottom: 1px solid #003344; }
        .btn-up { width: 110px; padding: 5px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div id="hangar" class="menu">
        <h2 style="margin-top:0">ðŸš€ HANGAR</h2>
        <div id="gold-menu" class="gold-counter">ðŸ’° 0</div>
        
        <div class="upgrade-row">
            <span>CaÃ±ones: Lvl <span id="lvl-cannons">1</span></span>
            <button class="btn-up" onclick="buyUpgrade('cannons')">Mejorar (<span id="cost-cannons">150</span>)</button>
        </div>
        <div class="upgrade-row">
            <span>Cadencia: Lvl <span id="lvl-fireRate">1</span></span>
            <button class="btn-up" onclick="buyUpgrade('fireRate')">Mejorar (<span id="cost-fireRate">80</span>)</button>
        </div>
        <div class="upgrade-row">
            <span>Escudos: Lvl <span id="lvl-hp">1</span></span>
            <button class="btn-up" onclick="buyUpgrade('hp')">Mejorar (<span id="cost-hp">100</span>)</button>
        </div>
        
        <button style="margin-top:20px; background:#006622; color:white; border-color:#00ff00;" onclick="startMission()">INICIAR MISIÃ“N</button>
        <p style="font-size: 0.7em; color: #888;">Arrastra para mover â€¢ Disparo automÃ¡tico</p>
    </div>

    <canvas id="gameCanvas" class="hidden"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    // Ajuste de resoluciÃ³n
    canvas.width = 400;
    canvas.height = 600;

    // --- BASE DE DATOS DE ENEMIGOS ---
    const enemyTiers = [
        { hp: 1, color: "#ff4444" }, // Nivel 1
        { hp: 2, color: "#ff8800" }, // Nivel 2
        { hp: 3, color: "#ffff00" }, 
        { hp: 5, color: "#00ff00" }, 
        { hp: 7, color: "#0088ff" }, 
        { hp: 10, color: "#8800ff" }, 
        { hp: 14, color: "#ff00ff" }, 
        { hp: 20, color: "#ffffff" }, 
        { hp: 30, color: "#555555" }, 
        { hp: 50, color: "#330000" }  // Nivel 10
    ];

    let stats = {
        gold: 0,
        upgrades: {
            cannons: { lvl: 1, cost: 150, max: 5 },
            fireRate: { lvl: 1, cost: 80, val: 500 },
            hp: { lvl: 1, cost: 100, val: 1 }
        }
    };

    let gameActive = false;
    let missionScore = 0;
    let missionLevel = 1;
    let lastFire = 0;
    let player = { x: 185, y: 500, w: 30, h: 30, hp: 1 };
    let bullets = [];
    let enemies = [];

    // --- CONTROLES ---
    function handleMove(e) {
        if (!gameActive) return;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        player.x = (clientX - rect.left) * (canvas.width / rect.width) - player.w/2;
        
        // Limites
        if (player.x < 0) player.x = 0;
        if (player.x > canvas.width - player.w) player.x = canvas.width - player.w;
    }

    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e); }, {passive: false});

    function updateUI() {
        document.getElementById("gold-menu").innerText = `ðŸ’° ${stats.gold}`;
        for (let key in stats.upgrades) {
            let u = stats.upgrades[key];
            document.getElementById(`lvl-${key}`).innerText = u.lvl;
            document.getElementById(`cost-${key}`).innerText = (u.max && u.lvl >= u.max) ? "MAX" : u.cost;
        }
    }

    function buyUpgrade(type) {
        let u = stats.upgrades[type];
        if (u.max && u.lvl >= u.max) return;
        if (stats.gold >= u.cost) {
            stats.gold -= u.cost;
            u.lvl++;
            u.cost = Math.floor(u.cost * 1.8);
            if (type === 'fireRate') u.val = Math.max(100, u.val - 60);
            updateUI();
        } else {
            alert("No tienes suficiente oro");
        }
    }

    function startMission() {
        document.getElementById("hangar").classList.add("hidden");
        canvas.classList.remove("hidden");
        gameActive = true;
        missionScore = 0;
        missionLevel = 1;
        player.hp = stats.upgrades.hp.lvl; // Vida segÃºn mejora de escudos
        bullets = [];
        enemies = [];
        requestAnimationFrame(gameLoop);
    }

    function endGame() {
        gameActive = false;
        let earned = Math.floor(missionScore / 10);
        stats.gold += earned;
        alert(`FIN DE LA MISIÃ“N\n\nNivel alcanzado: ${missionLevel}\nMonedas ganadas: ${earned}`);
        canvas.classList.add("hidden");
        document.getElementById("hangar").classList.remove("hidden");
        updateUI();
    }

    function gameLoop(time) {
        if (!gameActive) return;

        // 1. Subir de nivel de misiÃ³n basado en puntos
        if (missionScore > missionLevel * 1500 && missionLevel < 10) {
            missionLevel++;
        }

        // 2. Disparo AutomÃ¡tico
        if (time - lastFire > stats.upgrades.fireRate.val) {
            let n = stats.upgrades.cannons.lvl;
            for(let i=0; i<n; i++) {
                let offset = (i - (n-1)/2) * 15;
                bullets.push({ x: player.x + 13 + offset, y: player.y, s: 8 });
            }
            lastFire = time;
        }

        // 3. Mover Balas
        for (let i = bullets.length - 1; i >= 0; i--) {
            bullets[i].y -= bullets[i].s;
            if (bullets[i].y < -20) bullets.splice(i, 1);
        }

        // 4. Crear Enemigos
        if (Math.random() < 0.03 + (missionLevel * 0.005)) {
            let maxTierIndex = Math.min(missionLevel - 1, 9);
            let randomTier = Math.floor(Math.random() * (maxTierIndex + 1));
            let config = enemyTiers[randomTier];
            
            enemies.push({
                x: Math.random() * (canvas.width - 30),
                y: -30,
                s: 2 + (Math.random() * 1.5),
                hp: config.hp,
                maxHp: config.hp,
                color: config.color,
                tier: randomTier
            });
        }

        // 5. Mover Enemigos y Colisiones
        for (let i = enemies.length - 1; i >= 0; i--) {
            let en = enemies[i];
            en.y += en.s;

            // ColisiÃ³n con Jugador
            if (player.x < en.x + 30 && player.x + 30 > en.x && player.y < en.y + 30 && player.y + 30 > en.y) {
                player.hp--;
                enemies.splice(i, 1);
                if (player.hp <= 0) { endGame(); return; }
                continue;
            }

            // ColisiÃ³n con Balas
            for (let j = bullets.length - 1; j >= 0; j--) {
                let b = bullets[j];
                if (b.x < en.x + 30 && b.x + 4 > en.x && b.y < en.y + 30 && b.y + 10 > en.y) {
                    en.hp--;
                    bullets.splice(j, 1);
                    if (en.hp <= 0) {
                        missionScore += (en.tier + 1) * 50;
                        enemies.splice(i, 1);
                        break;
                    }
                }
            }

            if (en.y > canvas.height) enemies.splice(i, 1);
        }

        draw();
        requestAnimationFrame(gameLoop);
    }

    function draw() {
        ctx.fillStyle = "#050510";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Estrellas de fondo
        ctx.fillStyle = "#ffffff";
        for(let i=0; i<5; i++) ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 1, 1);

        // Jugador (Nave con brillo)
        ctx.shadowBlur = 10;
        ctx.shadowColor = "#00d4ff";
        ctx.fillStyle = "#00d4ff";
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // Balas
        ctx.shadowBlur = 5;
        ctx.shadowColor = "#ffff00";
        ctx.fillStyle = "#ffff00";
        bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));

        // Enemigos
        ctx.shadowBlur = 0;
        enemies.forEach(en => {
            ctx.fillStyle = en.color;
            ctx.fillRect(en.x, en.y, 30, 30);
            
            // Barra de vida
            ctx.fillStyle = "#330000";
            ctx.fillRect(en.x, en.y - 6, 30, 4);
            ctx.fillStyle = "#00ff00";
            ctx.fillRect(en.x, en.y - 6, (en.hp / en.maxHp) * 30, 4);
        });

        // HUD
        ctx.shadowBlur = 0;
        ctx.fillStyle = "white";
        ctx.font = "bold 14px Arial";
        ctx.fillText(`PUNTOS: ${missionScore}`, 10, 25);
        ctx.fillText(`NIVEL: ${missionLevel}`, 10, 45);
        ctx.fillStyle = "#00ffcc";
        ctx.fillText(`ESCUDOS: ${player.hp}`, 10, 65);
    }

    updateUI();
</script>
</body>
</html>
